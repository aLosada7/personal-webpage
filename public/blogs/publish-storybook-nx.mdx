---
title: Publish a Storybook with Nx
date: May 15th 2022
---

export const meta = {
	title: "Publish a Storybook with Nx",
	publishedOn: "May 15th 2022",
	slug: "publish-storybook-nx",
};

In this blog I want to show one of the main outcomes I have gotten after being working for several months with Nx. It has saved me lots and lots of time and also give me great support for linting, building or testing my projects.

As a Front-end Engineer I am always trying to learn better ways to optimize test implementantion. I had been struggling a lot with visual testing, as it is challenging not to introduce any visual bug when you are working in a new feature, specially working in components which appear in different UIs of your app. In this cases, you may need to refactorize your code at some point of the development to prevent scability issues.

Catching these kind of bugs is a tremendously ardous task to be perform, so automatization comes as one of the best solutions which can help you to drastically reduce the number of visual bugs introduced in your application.

## Stop, please! I have heard about Storybook, but I didn’t know visual testing with this tool could be automated

As some of you know (don’t worry if you don’t), Storybook is a UI component explorer created for front-end developers. It allows to create UI components in an isolated environment, making easy to introduce tests or improve accesibility. Apart from this, it can be integrated with a bunch of called _add-ons_ which will also help you to improve your documentation or check the level of responsiveness of your application.

One of the best approaches when using Storybook consists of creating a single story for every single state your component can take. My advice is to develop the component first in its most common “default” state with all data present. Then write stories for edge cases like one having no data or with some missing data. After doing this, you can also check the behaviour of the component for different devices (breakpoints) and other aspects regarding the component. As soon as you start working with it, you will feel more confortable, due to the fact that its learning curve is relatively easy.

They have recently released an [Encyclopedia](https://storybook.js.org/showcase/) where you can find a lot of system designs from recognized companies as Github, Adobe or The Guardian.

The team under Storybook itself has created Chromatic, which will take the responsibility for checking UI changes in your stories, helping you to automate the visual testing job.

Since a while, I am working with Nx from Nrwl as my trusted monorepo management tool. I use it to host all my projects regardless these use one technology or another. Nx has a great support for the prevailing frameworks and libraries, what I truly appreciate. Nx enforces you to introduce good practices, gives you and your team a lot of flexibility and improves code organisation, among other advantages. For me, what I value the most is the development experience thanks to VSCode integration.

## Now, how can we automate visual testing?

[https://stackoverflow.com/questions/65041989/storybook-angular-nx-workspace-how-to-publish-using-chromatic](https://stackoverflow.com/questions/65041989/storybook-angular-nx-workspace-how-to-publish-using-chromatic)

Maybe you do want to show your great work to your friends or a fellow. If you want to do that and you are not worried about having a proper domain name, you can have your Storybook live after applying some simple steps. It will take you no more than 10 minutes.

These are the steps you have to follow:

1. Create a new proyect in Chromatic. Chromatic will give you a key you will have to use in the following steps.
2. Run _build-storybook_ command to generate the bundle. You can do it directly from the Nx console if you have this extension installed (I highly recommend you to install it if you are working with Nx)
3. Having done that, if you are using one of the last versions from Nx, you have to add a new object under **targets**, in the _project.json_ of your project*,* adding **the **following content:

```json
"chromatic": {
    "executor": "@nrwl/workspace:run-commands",
    "options": {
        "commands": [
            "nx run dana:build-storybook",
            "npx chromatic --project-token=<ID_TOKEN> -d=dist/storybook/<PROJECT_NAME> --auto-accept-changes"
        ],
        "parallel": false
    }
}
```

Remember to replace your project token in the second command. Moreover, the bundle generated in the previous step is always located in the _dist_ folder, so you will have to change the dist path, pointing your folder.

The **—auto-acept-changes** flag allows you to accept all the visual changes without reviewing them in detail. I encourage you to remove this option in case you want to approve (or not) every single change detected in a story.

You will see how you can save a lot of time having only to check those stories that have changed. You can do this process before doing a commit or even less frequently.

## Why do this?

I have run into many cases in which I thought a small change haven’t had any consequences. After a while, a bug appears and after losing some time debugging it you discover it was produced by a previour change. For example, a change in the icon position which I thought only affected side navigation showed me after running Chromatic a change in the accordion component, which I hadn’t notice. In this case, the change was necessary but there are many times where I would have introduced a bug if I weren’t using this automatic tool.
